https://github.com/dotnet/runtime/issues/72415#issuecomment-1205540035

- Files
[SDK]
 1) Sdks\Microsoft.NET.Sdk\targets\Microsoft.NET.Sdk.props
    +   <Import Project="Sdk.props" Sdk="Microsoft.DotNet.ILCompiler" />
 2) C:\work\core\CurrentWork\runtime\src\installer\pkg\projects\Microsoft.DotNet.ILCompiler\sdk\Sdk.props
    +   <Import Project="$(MSBuildThisFileDirectory)..\build\Microsoft.DotNet.ILCompiler.props" Condition="'$(ILCompilerTargetsPath)' == ''" />
    + Also sets ILCompilerTargetsPath to true if ILCompilerTargetsPath is empty
 3) C:\work\core\CurrentWork\runtime\src\coreclr\nativeaot\BuildIntegration\Microsoft.DotNet.ILCompiler.props
    +     <ILCompilerTargetsPath>$(MSBuildThisFileDirectory)Microsoft.DotNet.ILCompiler.SingleEntry.targets</ILCompilerTargetsPath>
    + Also sets PublishAot if not set
 4) C:\work\core\CurrentWork\runtime\src\coreclr\nativeaot\BuildIntegration\Microsoft.DotNet.ILCompiler.SingleEntry.targets
    + [Property] if RuntimeIdentifier is not empty, set some os-arch related Properties
        # also sets IlcHostPackageName, IlcCalledViaPackage
    + [Property] If the NativeAOT toolchain is being consumed via package, runtime-specific properties must be set before compilation can proceed
        # ImportRuntimeIlcPackageTargetDependsOn, IlcSetupPropertiesDependsOn, IlcDynamicBuildPropertyDependencies
    + [Property] If called via package instead of the SDK, Update the runtime package version to match the build package
    + [Target] Locate the runtime package according to the current target runtime
        # RuntimePackagePath, IlcHostPackagePath, IlcPath
 5) C:\work\core\CurrentWork\runtime\src\coreclr\nativeaot\BuildIntegration\Microsoft.NETCore.Native.targets
    + [Property] Set defaults for unspecified properties
    + [Property] Set up the defaults for the compatibility mode
    + [Property] Set up default feature switches
    + [Property] Set native asset properties

 - Changes
https://github.com/dotnet/runtime/pull/73416

+ Rename to Microsoft.DotNet.ILCompiler.SingleEntry.targets (Microsoft.DotNet.ILCompiler.targets)
   # So as to avoid package autotmatically load Microsoft.DotNet.ILCompiler.targets as well
+ Harden to PublishAot (set to true, empty, false)
+ Harden to publish and build verbs
+ Update build package version to explicit reference to the build package if one exists
+ 


@TODO
 - Understand repo references to the build assets
 - TrimMode impact
 - Why Metadata test file


 Check
  - Actual tests Ran
  runtime - https://helixre107v0xdeko0k025g8.blob.core.windows.net/dotnet-runtime-refs-pull-73416-merge-e6e06482fc2d45fd92/System.Runtime.Tests/1/console.58eec409.log?helixlogtype=result
  extra - https://helixre107v0xdeko0k025g8.blob.core.windows.net/dotnet-runtime-refs-pull-73416-merge-7602f19653e6434787/Microsoft.Extensions.Logging.Tests/1/console.6afba610.log?helixlogtype=result
  - Check Michal's changes made the tests run
  Yes, without the change!
  - ILCLoaded via package